<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion - SerreConnect</title>
    <link rel="stylesheet" href="styles.css">
 
</head>
<body>
    <!-- Authentication Section -->
    <div id="auth-section">
        <div class="auth-container">
            <h2 class="text-center mb-20">
                <i class="fas fa-leaf"></i> Accès Serre Connectée
            </h2>
            
            <?php if (isset($_GET['error'])): ?>
                <div class="error-message">
                    <?php 
                    if ($_GET['error'] === 'invalid_credentials') {
                        echo "Identifiants incorrects. Veuillez réessayer.";
                    } elseif ($_GET['error'] === 'password_mismatch') {
                        echo "Les mots de passe ne correspondent pas.";
                    }
                    ?>
                </div>
            <?php endif; ?>
            
            <div id="login-form">
                <h3 class="mb-20">Connexion</h3>
                <form id="loginForm" action="../model/auth.php" method="POST">
                    <input type="hidden" name="action" value="login">
                    <div class="form-group">
                        <label for="loginEmail">
                            <i class="fas fa-envelope"></i> Email
                        </label>
                        <input type="email" id="loginEmail" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">
                            <i class="fas fa-lock"></i> Mot de passe
                        </label>
                        <input type="password" id="loginPassword" name="password" required>
                    </div>
                    <button type="submit" class="btn">
                        <i class="fas fa-sign-in-alt"></i> Se connecter
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="showRegister()">
                        <i class="fas fa-user-plus"></i> S'inscrire
                    </button>
                </form>
            </div>

            <div id="register-form" class="hidden">
                <h3 class="mb-20">Inscription</h3>
                <form id="registerForm" action="../model/auth.php" method="POST">
                    <input type="hidden" name="action" value="register">
                    <div class="form-group">
                        <label for="registerEmail">
                            <i class="fas fa-envelope"></i> Email
                        </label>
                        <input type="email" id="registerEmail" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">
                            <i class="fas fa-lock"></i> Mot de passe
                        </label>
                        <input type="password" id="registerPassword" name="password" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">
                            <i class="fas fa-lock"></i> Confirmer le mot de passe
                        </label>
                        <input type="password" id="confirmPassword" name="confirmPassword" required>
                    </div>
                    <button type="submit" class="btn">
                        <i class="fas fa-user-plus"></i> S'inscrire
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="showLogin()">
                        <i class="fas fa-sign-in-alt"></i> Déjà inscrit ?
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Vérifier si l'utilisateur est déjà connecté au chargement
        document.addEventListener('DOMContentLoaded', function() {
            // Vérification côté client pour améliorer l'expérience utilisateur
            // La vraie vérification se fera côté serveur
            const userLoggedIn = <?php echo isset($_SESSION['user']) ? 'true' : 'false'; ?>;
            if (userLoggedIn) {
                window.location.href = 'Site.html';
            }
        });

        // Fonctions d'affichage
        function showLogin() {
            document.getElementById('login-form').classList.remove('hidden');
            document.getElementById('register-form').classList.add('hidden');
        }

        function showRegister() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('register-form').classList.remove('hidden');
        }

        // Validation côté client avant soumission
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (password !== confirmPassword) {
                e.preventDefault();
                alert('Les mots de passe ne correspondent pas');
                return false;
            }
            return true;
        });
    </script>
</body>
</html>