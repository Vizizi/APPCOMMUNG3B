<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Serre Connectée</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>

<body>
    <div class="container">
        <header>
            <nav>
                <div class="logo">
                    <i class="fas fa-leaf"></i>
                    Serre Connectée
                </div>
                <div class="nav-links">
                    <a href="#" onclick="showSection('dashboard'); return false;">
                        <i class="fas fa-tachometer-alt"></i>
                        Tableau de Bord
                    </a>
                    <a href="#" onclick="showSection('sensors'); return false;">
                        <i class="fas fa-sensors"></i>
                        État des Capteurs
                    </a>
                    <a href="#" onclick="showSection('actuators'); return false;">
                        <i class="fas fa-power-off"></i>
                        Actionneurs
                    </a>
                    <a href="#" onclick="showSection('auth'); return false;">
                        <i class="fas fa-user"></i>
                        Authentification
                    </a>
                </div>
            </nav>
        </header>

        <!-- Dashboard Section -->
        <div id="dashboard-section">
            <div class="dashboard">
                <div class="sensors-section">
                    <h2 class="section-title text-center">
                        <i class="fas fa-sensors"></i>
                        État des Capteurs
                    </h2>
                    <div class="sensors-grid">
                        <div class="sensor-card" id="temperature-card">
                            <div class="sensor-header">
                                <div class="sensor-info">
                                    <div class="sensor-icon">
                                        <i class="fas fa-thermometer-half"></i>
                                    </div>
                                    <div class="sensor-title">
                                        Température
                                    </div>
                                </div>
                                <div class="sensor-status status-optimal">
                                    <i class="fas fa-check-circle"></i>
                                    Optimal
                                </div>
                            </div>
                            <div class="sensor-value" id="temp-value">
                                22.5°C
                            </div>
                        </div>
                        <div class="sensor-card" id="humidity-card">
                            <div class="sensor-header">
                                <div class="sensor-info">
                                    <div class="sensor-icon">
                                        <i class="fas fa-tint"></i>
                                    </div>
                                    <div class="sensor-title">
                                        Humidité
                                    </div>
                                </div>
                                <div class="sensor-status status-optimal">
                                    <i class="fas fa-check-circle"></i>
                                    Optimal
                                </div>
                            </div>
                            <div class="sensor-value" id="humidity-value">
                                65.2%
                            </div>
                        </div>
                        <div class="sensor-card" id="light-card">
                            <div class="sensor-header">
                                <div class="sensor-info">
                                    <div class="sensor-icon">
                                        <i class="fas fa-sun"></i>
                                    </div>
                                    <div class="sensor-title">
                                        Luminosité
                                    </div>
                                </div>
                                <div class="sensor-status status-optimal">
                                    <i class="fas fa-check-circle"></i>
                                    Optimal
                                </div>
                            </div>
                            <div class="sensor-value" id="light-value">
                                850 lux
                            </div>
                        </div>
                        <div class="sensor-card" id="co2-card">
                            <div class="sensor-header">
                                <div class="sensor-info">
                                    <div class="sensor-icon">
                                        <i class="fas fa-wind"></i>
                                    </div>
                                    <div class="sensor-title">
                                        CO₂
                                    </div>
                                </div>
                                <div class="sensor-status status-optimal">
                                    <i class="fas fa-check-circle"></i>
                                    Optimal
                                </div>
                            </div>
                            <div class="sensor-value" id="co2-value">
                                420 ppm
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-section">
                <h2 class="section-title">
                    <i class="fas fa-chart-line"></i>
                    Évolution des Paramètres (24h)
                </h2>
                <div class="chart-container">
                    <canvas id="sensorsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Sensors Section -->
        <div id="sensors-section" class="hidden">
            <div class="sensors-section">
                <h2 class="section-title">
                    <i class="fas fa-sensors"></i>
                    État des Capteurs
                </h2>
                <div class="sensors-grid">
                    <div class="sensor-card" id="temperature-card">
                        <div class="sensor-header">
                            <div class="sensor-info">
                                <div class="sensor-icon">
                                    <i class="fas fa-thermometer-half"></i>
                                </div>
                                <div class="sensor-title">
                                    Température
                                </div>
                            </div>
                            <div class="sensor-status status-optimal">
                                <i class="fas fa-check-circle"></i>
                                Optimal
                            </div>
                        </div>
                        <div class="sensor-value" id="temp-value">
                            22.5°C
                        </div>
                    </div>
                    <div class="sensor-card" id="humidity-card">
                        <div class="sensor-header">
                            <div class="sensor-info">
                                <div class="sensor-icon">
                                    <i class="fas fa-tint"></i>
                                </div>
                                <div class="sensor-title">
                                    Humidité
                                </div>
                            </div>
                            <div class="sensor-status status-optimal">
                                <i class="fas fa-check-circle"></i>
                                Optimal
                            </div>
                        </div>
                        <div class="sensor-value" id="humidity-value">
                            65.2%
                        </div>
                    </div>
                    <div class="sensor-card" id="light-card">
                        <div class="sensor-header">
                            <div class="sensor-info">
                                <div class="sensor-icon">
                                    <i class="fas fa-sun"></i>
                                </div>
                                <div class="sensor-title">
                                    Luminosité
                                </div>
                            </div>
                            <div class="sensor-status status-optimal">
                                <i class="fas fa-check-circle"></i>
                                Optimal
                            </div>
                        </div>
                        <div class="sensor-value" id="light-value">
                            850 lux
                        </div>
                    </div>
                    <div class="sensor-card" id="co2-card">
                        <div class="sensor-header">
                            <div class="sensor-info">
                                <div class="sensor-icon">
                                    <i class="fas fa-wind"></i>
                                </div>
                                <div class="sensor-title">
                                    CO₂
                                </div>
                            </div>
                            <div class="sensor-status status-optimal">
                                <i class="fas fa-check-circle"></i>
                                Optimal
                            </div>
                        </div>
                        <div class="sensor-value" id="co2-value">
                            420 ppm
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actuators Section -->
        <div id="actuators-section" class="hidden">
            <div class="controls-section">
                <h2 class="section-title">
                    <i class="fas fa-power-off"></i>
                    Actionneurs
                </h2>
                <div class="actuator-controls">
                    <div class="actuator-item">
                        <div class="actuator-info">
                            <div class="actuator-icon">
                                <i class="fas fa-tint"></i>
                            </div>
                            <div class="actuator-title">
                                Arrosage
                            </div>
                        </div>
                        <div class="toggle-switch" onclick="toggleActuator(this, 'irrigation')"></div>
                    </div>
                    <div class="actuator-item">
                        <div class="actuator-info">
                            <div class="actuator-icon">
                                <i class="fas fa-fan"></i>
                            </div>
                            <div class="actuator-title">
                                Ventilation
                            </div>
                        </div>
                        <div class="toggle-switch" onclick="toggleActuator(this, 'ventilation')"></div>
                    </div>
                    <div class="actuator-item">
                        <div class="actuator-info">
                            <div class="actuator-icon">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            <div class="actuator-title">
                                Éclairage
                            </div>
                        </div>
                        <div class="toggle-switch" onclick="toggleActuator(this, 'lighting')"></div>
                    </div>
                    <div class="actuator-item">
                        <div class="actuator-info">
                            <div class="actuator-icon">
                                <i class="fas fa-fire"></i>
                            </div>
                            <div class="actuator-title">
                                Chauffage
                            </div>
                        </div>
                        <div class="toggle-switch" onclick="toggleActuator(this, 'heating')"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Auth Section -->
        <div id="auth-section" class="hidden">
            <div class="auth-container">
                <h2 class="text-center mb-20">
                    <i class="fas fa-leaf"></i> Accès Serre Connectée
                </h2>
                <div id="login-form">
                    <h3 class="mb-20">Connexion</h3>
                    <form id="loginForm" action="#" method="POST">
                        <div class="form-group">
                            <label for="loginEmail">
                                <i class="fas fa-envelope"></i> Email
                            </label>
                            <input type="email" id="loginEmail" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">
                                <i class="fas fa-lock"></i> Mot de passe
                            </label>
                            <input type="password" id="loginPassword" name="password" required>
                        </div>
                        <button type="submit" class="btn">
                            <i class="fas fa-sign-in-alt"></i> Se connecter
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="showRegister()">
                            <i class="fas fa-user-plus"></i> S'inscrire
                        </button>
                    </form>
                </div>
                <div id="register-form" class="hidden">
                    <h3 class="mb-20">Inscription</h3>
                    <form id="registerForm" action="#" method="POST">
                        <div class="form-group">
                            <label for="registerEmail">
                                <i class="fas fa-envelope"></i> Email
                            </label>
                            <input type="email" id="registerEmail" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="registerPassword">
                                <i class="fas fa-lock"></i> Mot de passe
                            </label>
                            <input type="password" id="registerPassword" name="password" required>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">
                                <i class="fas fa-lock"></i> Confirmer le mot de passe
                            </label>
                            <input type="password" id="confirmPassword" name="confirmPassword" required>
                        </div>
                        <button type="submit" class="btn">
                            <i class="fas fa-user-plus"></i> S'inscrire
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="showLogin()">
                            <i class="fas fa-sign-in-alt"></i> Déjà inscrit ?
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        // Variables globales
        let currentUser = null;
        let sensorData = {
            temperature: [],
            humidity: [],
            light: [],
            co2: []
        };

        // Gestion de la navigation
        function showSection(sectionName) {
            // Masquer toutes les sections
            const sections = ['dashboard', 'sensors', 'actuators', 'auth'];
            sections.forEach(section => {
                const element = document.getElementById(section + '-section');
                if (element) {
                    element.classList.add('hidden');
                }
            });

            // Afficher la section demandée
            const targetSection = document.getElementById(sectionName + '-section');
            if (targetSection) {
                targetSection.classList.remove('hidden');
            } else {
                // Si la section n'existe pas, afficher le dashboard
                document.getElementById('dashboard-section').classList.remove('hidden');
            }

            // Mettre à jour la navigation active
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');

            // Charger les données spécifiques à la section
            if (sectionName === 'dashboard') {
                initChart();
            }
        }

        // Gestion de l'authentification
        function showLogin() {
            document.getElementById('login-form').classList.remove('hidden');
            document.getElementById('register-form').classList.add('hidden');
        }

        function showRegister() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('register-form').classList.remove('hidden');
        }

        document.getElementById('registerForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (password !== confirmPassword) {
                showAlert('Les mots de passe ne correspondent pas', 'danger');
                return;
            }

            if (email && password) {
                showAlert('Inscription réussie ! Vous pouvez maintenant vous connecter.', 'success');
                showLogin();
            }
        });

        // Gestion des actionneurs
        function toggleActuator(element, actuatorType) {
            element.classList.toggle('active');
            const isActive = element.classList.contains('active');

            // Simulation d'envoi de commande
            console.log(`${actuatorType}: ${isActive ? 'ON' : 'OFF'}`);

            // Afficher une notification
            showAlert(`${actuatorType} ${isActive ? 'activé' : 'désactivé'}`, 'success');

            // Ici vous pouvez ajouter l'appel AJAX vers le serveur
            // updateActuator(actuatorType, isActive);
        }

        // Fonction pour afficher les alertes
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'times-circle'}"></i>
                ${message}
            `;

            document.body.appendChild(alertDiv);

            // Supprimer l'alerte après 3 secondes
            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        }

        // Simulation de données en temps réel
        function generateSensorData() {
            return {
                temperature: 18 + Math.random() * 12, // 18-30°C
                humidity: 55 + Math.random() * 25,    // 55-80%
                light: 600 + Math.random() * 800,    // 600-1400 lux
                co2: 350 + Math.random() * 200       // 350-550 ppm
            };
        }

        // Mise à jour des capteurs
        function updateSensorValues() {
            const data = generateSensorData();

            // Mettre à jour les valeurs affichées
            document.getElementById('temp-value').textContent = data.temperature.toFixed(1) + '°C';
            document.getElementById('humidity-value').textContent = data.humidity.toFixed(1) + '%';
            document.getElementById('light-value').textContent = Math.round(data.light) + ' lux';
            document.getElementById('co2-value').textContent = Math.round(data.co2) + ' ppm';

            // Mettre à jour les statuts
            updateSensorStatus('temperature', data.temperature, 18, 25);
            updateSensorStatus('humidity', data.humidity, 60, 70);
            updateSensorStatus('light', data.light, 800, 1200);
            updateSensorStatus('co2', data.co2, 350, 450);

            // Stocker les données pour le graphique
            const timestamp = new Date();
            Object.keys(data).forEach(sensor => {
                sensorData[sensor].push({
                    x: timestamp,
                    y: data[sensor]
                });

                // Garder seulement les 50 derniers points
                if (sensorData[sensor].length > 50) {
                    sensorData[sensor].shift();
                }
            });

            // Mettre à jour le graphique si il existe
            if (window.sensorsChart) {
                updateChart();
            }
        }

        // Mise à jour du statut des capteurs
        function updateSensorStatus(sensorType, value, minOptimal, maxOptimal) {
            const card = document.getElementById(sensorType + '-card');
            const statusElement = card.querySelector('.sensor-status');

            let status, statusClass, icon;

            if (value >= minOptimal && value <= maxOptimal) {
                status = 'Optimal';
                statusClass = 'status-optimal';
                icon = 'check-circle';
            } else if (value < minOptimal * 0.8 || value > maxOptimal * 1.3) {
                status = 'Critique';
                statusClass = 'status-critical';
                icon = 'times-circle';
            } else {
                status = 'Attention';
                statusClass = 'status-warning';
                icon = 'exclamation-triangle';
            }

            statusElement.className = `sensor-status ${statusClass}`;
            statusElement.innerHTML = `<i class="fas fa-${icon}"></i> ${status}`;
        }

        // Initialisation du graphique
        function initChart() {
            const ctx = document.getElementById('sensorsChart');
            if (!ctx) return;

            window.sensorsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'Température (°C)',
                            data: sensorData.temperature,
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Humidité (%)',
                            data: sensorData.humidity,
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Luminosité (lux/10)',
                            data: sensorData.light.map(d => ({ x: d.x, y: d.y / 10 })),
                            borderColor: '#f39c12',
                            backgroundColor: 'rgba(243, 156, 18, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'CO₂ (ppm/10)',
                            data: sensorData.co2.map(d => ({ x: d.x, y: d.y / 10 })),
                            borderColor: '#27ae60',
                            backgroundColor: 'rgba(39, 174, 96, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'minute'
                            }
                        },
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Évolution des Paramètres de la Serre'
                        }
                    }
                }
            });
        }

        // Mise à jour du graphique
        function updateChart() {
            if (window.sensorsChart) {
                window.sensorsChart.data.datasets[0].data = sensorData.temperature;
                window.sensorsChart.data.datasets[1].data = sensorData.humidity;
                window.sensorsChart.data.datasets[2].data = sensorData.light.map(d => ({ x: d.x, y: d.y / 10 }));
                window.sensorsChart.data.datasets[3].data = sensorData.co2.map(d => ({ x: d.x, y: d.y / 10 }));
                window.sensorsChart.update('none');
            }
        }

        // Communication avec le serveur (simulation)
        function sendSensorData(sensorType, value) {
            // Ici vous ajouteriez l'appel AJAX réel
            /*
            fetch('api/sensors.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    sensor_type: sensorType,
                    value: value,
                    serre_id: 1
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Data sent:', data);
            })
            .catch(error => {
                console.error('Error:', error);
            });
            */
        }

        function updateActuator(actuatorType, status) {
            // Ici vous ajouteriez l'appel AJAX réel
            /*
            fetch('api/actuators.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    actuator_type: actuatorType,
                    status: status,
                    serre_id: 1
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Actuator updated:', data);
            })
            .catch(error => {
                console.error('Error:', error);
            });
            */
        }

        // Initialisation au chargement de la page
        document.addEventListener('DOMContentLoaded', function () {
            // Générer des données initiales
            for (let i = 0; i < 10; i++) {
                const data = generateSensorData();
                const timestamp = new Date(Date.now() - (10 - i) * 60000); // 1 minute d'intervalle

                Object.keys(data).forEach(sensor => {
                    sensorData[sensor].push({
                        x: timestamp,
                        y: data[sensor]
                    });
                });
            }

            // Première mise à jour
            updateSensorValues();

            // Initialiser le graphique
            setTimeout(initChart, 100);

            // Mettre à jour les données toutes les 5 secondes
            setInterval(updateSensorValues, 5000);
        });
    </script>
</body>

</html>
